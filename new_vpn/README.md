## 新版校园VPN(aTrust) 自动授权

### 依赖库
+ httpx
+ lxml

### 问题
+ 用Python请求总是会出现证书问题，要用上 `verify=False`
+ 碰到302很容易报错...如下（网上说是多次重定向 导致 访问次数过多)
> requests.exceptions.SSLError: HTTPSConnectionPool
+ 现在单个网页请求也要认证 
`/controller/v1/public/verify?t=`
要请求 三次(认证)，获取`sdp_user_token`，没有这个cookie的话，
访问的页面全302，指向的是应用中心界面
> 翻了6个js文件，全都有混淆...最后找到的是一个`URLParse`函数，
> 
> 但声明函数是一个 参数执行... `URLParse=t()`，然后线索断了..

+ 所以现在获取不了`sdp_user_token`相当于白干...

### 原理

利用 **CAS票据认证**（其实旧版也是，但过程有些变动）
> 
> > 其实就是用 **信息门户** 认证 **VPN**
> 
> 后面找到了用户文档，77行以下是关于CAS认证的介绍
> 
> [aTrust用户文档pdf](https://max.book118.com/html/2022/0327/5202304102004204.shtm)


### 发现 cas 认证的过程

登录认证网页，学校设置的只能是 **企业微信** 扫码登录
> 
> 刚开始时，研究网页和扫码登录半天，都没看出啥情况...
> 
> 后面想起了旧版VPN的APP ： **EASYConnect** 
> 
> 之前通过APP发现的 旧版VPN的 CAS票据认证
> 
> （在填写VPN url地址后，里面有三个选项，其中一个是 CAS票据认证，由此发现新大陆）

于是在捣鼓半天后，我选择下载了aTrust手机APP，输入url后 果然出现了 **CAS** 图标

哈哈哈~

> 点进去就是信息门户，于是我开小黄鸟抓包，开启后重新打开，显示无法访问（证书问题吧）
> 
> 但是URL刚好就显示在报错信息里，复制粘贴~

### 吐槽
关掉 CAS认证 登录，但接口还能用...

这不就相当于 要锁门，结果撕掉门牌号吗...

不知道是深信服的漏洞，还是学校设置没设好